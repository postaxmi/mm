$((function(){var t,a;$("#map").parent().width();function n(t){var a=new Date(t);return["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][a.getDay()]+" "+a.getDate()}function o(t){return t+""}$.fn.qtip.defaults.style.classes="ui-tooltip-bootstrap",$.fn.qtip.defaults.style.def=!1;var e={coprifuoco:["Coprifuoco",o],color_region:["Zona",o]},r={ITC1:"Piemonte",ITC2:"Val d'Aosta",ITC3:"Liguria",ITC4:"Lombradia",ITD1:"Bolzano",ITD2:"Trento",ITD3:"Veneto",ITD4:"Friuli Veniezia Giulia",ITD5:"Emilia Romagna",ITE1:"Toscana",ITE2:"Umbria",ITE3:"Marche",ITE4:"Lazio",ITF1:"Abruzzo",ITF2:"Molise",ITF3:"Campania",ITF4:"Puglia",ITF5:"Basilicata",ITF6:"Calabria",ITG1:"Sicilia",ITG2:"Sardegna"},i={coprifuoco:{"22:00":"#D5F3FE","23:00":"#66D3FA"," ":"#3C99DC"},color_region:{bianca:"#ffffff",gialla:"#ffff00",rossa:"#ff0000"}};colorscales=["Oranges","Reds","Blues","Greens","Purples","Greys","OrRd","PuBu","BuPu","BuGn","YlOrBr","GnBu","PuRd","PuBuGn"],$.each(e,(function(t,a){$("#indicator").append('<button data-v="'+t+'">'+a[0]+"</button>")})),$.each(colorscales,(function(t,a){$("#colors").append("<option>"+a+"</option>")}));var d=[$.get("italy.svg").then((function(a){return $("#map").height($(window).height()-100),(t=kartograph.map("#map")).setMap(a),a})),$.getJSON("data2.min.json")];Promise.all(d).then((function(o){dataFull=o[1];var d=Object.keys(dataFull),l=new Date;l=l.toISOString().substr(0,10);for(var u=0,c=0;c<d.length;c++)if(d[c]===l){u=c;break}for(var s in d=d.slice(u),$.each(d,(function(t,a){var o=n(a);$("#date").append('<button data-v="'+a+'">'+o+"</button>")})),d)for(var c in date=d[s],data=dataFull[date],data)$("table tbody").append(`\n                    <tr class="${data[c].nuts2} ${date}">\n                    <td>${r[data[c].nuts2]||data[c].nuts2}</td>\n                    <th scope="row">${n(date)}</th>\n                    <td>${data[c].color_region}</td>\n                    <td>${data[c].coprifuoco}</td>\n                    </tr>`);var f,p=function(t){var a="";t.region&&(a+="."+t.region),t.date&&(a+="."+window._date),$("#report table tbody tr").hide(),$("#report table tbody tr"+a).show()},g=function(n){window._date=n;var o=dataFull[window._date];for(var e in f={},o)f[o[e].nuts2]=o[e];var r=v();t.getLayer("regions").style("fill",(function(t){return dd=f[t.nuts2],null==dd?"#0ff0ff":i[r]?i[r][dd[r]]:dd[r+"_color"]?dd[r+"_color"]:"#000000"})),a&&a.remove(),a=t.addSymbols({type:kartograph.Label,data:t.getLayer("regions").getPathsData(),location:function(t){return"regions."+t.nuts2},text:function(t){return f[t.nuts2].coprifuoco}}),p({date:window._date})},v=function(){return window._ind||"color_region"},b=function(){var a,o=(a=new Date,window._date||a.toISOString().substr(0,10)),r=v();prop_fmt=e[r][1],data=dataFull[o];var l={};for(var u in data)l[data[u].nuts2]=data[u];var c={};for(var s in d){var f=d[s],b=dataFull[f];for(var u in b)c[b[u].nuts2]=c[b[u].nuts2]||"",c[b[u].nuts2]+=`\n                            <tr>\n                            <th scope="row">${n(f)}</th>\n                            <td class="colorRegion-${b[u].color_region}">${b[u].color_region}</td>\n                            <td>${b[u].coprifuoco}</td>\n                            </tr>\n                            `}t.clear();var h=$("#legend");if(h.html(""),i[r])for(var w in i[r])h.append('<div class="legendLabel" style="background:'+i[r][w]+'">'+w+"&nbsp;</div>");t.addLayer("regions",{data:data,key:"nuts2",styles:{"stroke-width":.7,stroke:function(t){return"#00f"}},click:function(t){p({region:t.nuts2})},tooltips:function(t){return`<table class="tooltipTable">\n                            <thead class="thead-light">\n                                <tr>\n                                <th scope="col">Data</th>\n                                <th scope="col">Zona</th>\n                                <th scope="col">Coprifuoco</th>\n                                </tr>\n                            </thead>\n                            <tbody>${c[t.nuts2]}</tbody></table>`}}),g(o)};b(),$("#indicator button").click((function(t){var a=t.target.dataset.v;window._ind=a,b()})),$("#date button").click((function(t){$("#date button").removeClass("active"),$(t.target).addClass("active");var a=t.target.dataset.v;g(a)}))}))}));
