$((function(){$("#map").parent().width();function t(t){var a=new Date(t);return["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][a.getDay()]+" "+a.getDate()}function a(t){return t+""}$.fn.qtip.defaults.style.classes="ui-tooltip-bootstrap",$.fn.qtip.defaults.style.def=!1;var o={coprifuoco:["Coprifuoco",a],color_region:["Zona",a]},n={ITC1:"Piemonte",ITC2:"Val d'Aosta",ITC3:"Liguria",ITC4:"Lombradia",ITD1:"Bolzano",ITD2:"Trento",ITD3:"Veneto",ITD4:"Friuli Veniezia Giulia",ITD5:"Emilia Romagna",ITE1:"Toscana",ITE2:"Umbria",ITE3:"Marche",ITE4:"Lazio",ITF1:"Abruzzo",ITF2:"Molise",ITF3:"Campania",ITF4:"Puglia",ITF5:"Basilicata",ITF6:"Calabria",ITG1:"Sicilia",ITG2:"Sardegna"},r={coprifuoco:{"22:00":"#D5F3FE","23:00":"#66D3FA"," ":"#3C99DC"},color_region:{bianca:"#ffffff",gialla:"#ffff00",rossa:"#ff0000"}};colorscales=["Oranges","Reds","Blues","Greens","Purples","Greys","OrRd","PuBu","BuPu","BuGn","YlOrBr","GnBu","PuRd","PuBuGn"],$.each(o,(function(t,a){$("#indicator").append('<button data-v="'+t+'">'+a[0]+"</button>")})),$.each(colorscales,(function(t,a){$("#colors").append("<option>"+a+"</option>")})),$.getJSON("data2.json",(function(a){var e=Object.keys(a);for(var i in $.each(e,(function(a,o){var n=t(o);$("#date").append('<button data-v="'+o+'">'+n+"</button>")})),e)for(var d in date=e[i],data=a[date],data)$("table tbody").append(`\n                    <tr class="${data[d].nuts2} ${date}">\n                    <td>${n[data[d].nuts2]||data[d].nuts2}</td>\n                    <th scope="row">${t(date)}</th>\n                    <td>${data[d].color_region}</td>\n                    <td>${data[d].coprifuoco}</td>\n                    </tr>`);var c=function(t){var a="";t.region&&(a+="."+t.region),t.date&&(a+="."+window._date),$("#report table tbody tr").hide(),$("#report table tbody tr"+a).show()};$.get("italy.svg",(function(n){$("#map").height($(window).height()-100);var i,d=kartograph.map("#map");d.setMap(n);var s=function(){q=new Date,date=window._date||q.toISOString().substr(0,10),prop=window._ind||"color_region";prop;prop_fmt=o[prop][1],data=a[date];var n={};for(var i in data)n[data[i].nuts2]=data[i];var s={};for(var u in e){date=e[u];var l=a[date];for(var i in l)s[l[i].nuts2]=s[l[i].nuts2]||"",s[l[i].nuts2]+=`\n                            <tr>\n                            <th scope="row">${t(date)}</th>\n                            <td class="colorRegion-${l[i].color_region}">${l[i].color_region}</td>\n                            <td>${l[i].coprifuoco}</td>\n                            </tr>\n                            `}d.clear();var p=$("#legend");if(p.html(""),r[prop])for(var f in r[prop])p.append('<div class="legendLabel" style="background:'+r[prop][f]+'">'+f+"&nbsp;</div>");d.addLayer("regions",{data:data,key:"nuts2",styles:{"stroke-width":.7,fill:function(t){return null==(l=n[t.nuts2])?"#0ff0ff":r[prop]?r[prop][l[prop]]:l[prop+"_color"]?l[prop+"_color"]:"#000000"},stroke:function(t){return"#000"}},click:function(t){c({region:t.nuts2})},tooltips:function(t){return`<table class="tooltipTable">\n                            <thead class="thead-light">\n                                <tr>\n                                <th scope="col">Data</th>\n                                <th scope="col">Zona</th>\n                                <th scope="col">Coprifuoco</th>\n                                </tr>\n                            </thead>\n                            <tbody>${s[t.nuts2]}</tbody></table>`}}),d.addSymbols({type:kartograph.Label,data:d.getLayer("regions").getPathsData(),location:function(t){return"regions."+t.nuts2},text:function(t){return n[t.nuts2].coprifuoco}})};s(),$("#indicator button").click((function(t){var a=t.target.dataset.v;window._ind=a,s()})),$("#date button").click((function(t){$("#date button").removeClass("active"),$(t.target).addClass("active"),function(t){window._date=t;var o=a[window._date];for(var n in i={},o)i[o[n].nuts2]=o[n];d.getLayer("regions").style("fill",(function(t){return dd=i[t.nuts2],null==dd?"#0ff0ff":r[prop]?r[prop][dd[prop]]:dd[prop+"_color"]?dd[prop+"_color"]:"#000000"})),c({date:window._date})}(t.target.dataset.v)}))}))}))}));
