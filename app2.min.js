$((function(){var t;$("#map").parent().width();function a(t){var a=new Date(t);return["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][a.getDay()]+" "+a.getDate()}function o(t){return t+""}$.fn.qtip.defaults.style.classes="ui-tooltip-bootstrap",$.fn.qtip.defaults.style.def=!1;var n={coprifuoco:["Coprifuoco",o],color_region:["Zona",o]},r={ITC1:"Piemonte",ITC2:"Val d'Aosta",ITC3:"Liguria",ITC4:"Lombradia",ITD1:"Bolzano",ITD2:"Trento",ITD3:"Veneto",ITD4:"Friuli Veniezia Giulia",ITD5:"Emilia Romagna",ITE1:"Toscana",ITE2:"Umbria",ITE3:"Marche",ITE4:"Lazio",ITF1:"Abruzzo",ITF2:"Molise",ITF3:"Campania",ITF4:"Puglia",ITF5:"Basilicata",ITF6:"Calabria",ITG1:"Sicilia",ITG2:"Sardegna"},e={coprifuoco:{"22:00":"#D5F3FE","23:00":"#66D3FA"," ":"#3C99DC"},color_region:{bianca:"#ffffff",gialla:"#ffff00",rossa:"#ff0000"}};colorscales=["Oranges","Reds","Blues","Greens","Purples","Greys","OrRd","PuBu","BuPu","BuGn","YlOrBr","GnBu","PuRd","PuBuGn"],$.each(n,(function(t,a){$("#indicator").append('<button data-v="'+t+'">'+a[0]+"</button>")})),$.each(colorscales,(function(t,a){$("#colors").append("<option>"+a+"</option>")}));var i=[$.get("italy.svg").then((function(a){return $("#map").height($(window).height()-100),(t=kartograph.map("#map")).setMap(a),a})),$.getJSON("data2.json")];Promise.all(i).then((function(o){dataFull=o[1];var i=Object.keys(dataFull),d=new Date;d=d.toISOString().substr(0,10);for(var l=0,u=0;u<i.length;u++)if(i[u]===d){l=u;break}for(var c in i=i.slice(l),$.each(i,(function(t,o){var n=a(o);$("#date").append('<button data-v="'+o+'">'+n+"</button>")})),i)for(var u in date=i[c],data=dataFull[date],data)$("table tbody").append(`\n                    <tr class="${data[u].nuts2} ${date}">\n                    <td>${r[data[u].nuts2]||data[u].nuts2}</td>\n                    <th scope="row">${a(date)}</th>\n                    <td>${data[u].color_region}</td>\n                    <td>${data[u].coprifuoco}</td>\n                    </tr>`);var s,p=function(t){var a="";t.region&&(a+="."+t.region),t.date&&(a+="."+window._date),$("#report table tbody tr").hide(),$("#report table tbody tr"+a).show()},f=function(){q=new Date,date=window._date||q.toISOString().substr(0,10),prop=window._ind||"color_region";prop;prop_fmt=n[prop][1],data=dataFull[date];var o={};for(var r in data)o[data[r].nuts2]=data[r];var d={};for(var l in i){date=i[l];var u=dataFull[date];for(var r in u)d[u[r].nuts2]=d[u[r].nuts2]||"",d[u[r].nuts2]+=`\n                            <tr>\n                            <th scope="row">${a(date)}</th>\n                            <td class="colorRegion-${u[r].color_region}">${u[r].color_region}</td>\n                            <td>${u[r].coprifuoco}</td>\n                            </tr>\n                            `}t.clear();var c=$("#legend");if(c.html(""),e[prop])for(var s in e[prop])c.append('<div class="legendLabel" style="background:'+e[prop][s]+'">'+s+"&nbsp;</div>");t.addLayer("regions",{data:data,key:"nuts2",styles:{"stroke-width":.7,fill:function(t){return null==(u=o[t.nuts2])?"#0ff0ff":e[prop]?e[prop][u[prop]]:u[prop+"_color"]?u[prop+"_color"]:"#000000"},stroke:function(t){return"#000"}},click:function(t){p({region:t.nuts2})},tooltips:function(t){return`<table class="tooltipTable">\n                            <thead class="thead-light">\n                                <tr>\n                                <th scope="col">Data</th>\n                                <th scope="col">Zona</th>\n                                <th scope="col">Coprifuoco</th>\n                                </tr>\n                            </thead>\n                            <tbody>${d[t.nuts2]}</tbody></table>`}}),t.addSymbols({type:kartograph.Label,data:t.getLayer("regions").getPathsData(),location:function(t){return"regions."+t.nuts2},text:function(t){return o[t.nuts2].coprifuoco}})};f(),$("#indicator button").click((function(t){var a=t.target.dataset.v;window._ind=a,f()})),$("#date button").click((function(a){$("#date button").removeClass("active"),$(a.target).addClass("active"),function(a){window._date=a;var o=dataFull[window._date];for(var n in s={},o)s[o[n].nuts2]=o[n];t.getLayer("regions").style("fill",(function(t){return dd=s[t.nuts2],null==dd?"#0ff0ff":e[prop]?e[prop][dd[prop]]:dd[prop+"_color"]?dd[prop+"_color"]:"#000000"})),p({date:window._date})}(a.target.dataset.v)}))}))}));
